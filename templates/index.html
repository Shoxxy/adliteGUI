<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Adjust Event Controller</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; display: flex; justify-content: center; padding: 40px; }
        .card { background: #1e1e1e; padding: 25px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.5); width: 450px; border: 1px solid #333; }
        h2 { color: #bb86fc; text-align: center; margin-top: 0; }
        label { display: block; margin: 15px 0 5px; color: #aaa; font-size: 0.85rem; }
        select, input { width: 100%; padding: 12px; background: #2c2c2c; border: 1px solid #444; border-radius: 6px; color: white; font-size: 1rem; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: #bb86fc; color: #000; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        button:hover { background: #9965f4; }
        #log { margin-top: 20px; padding: 15px; background: #000; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.85rem; min-height: 40px; border-left: 4px solid #bb86fc; white-space: pre-wrap; }
        .loading { color: #888; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Adjust Controller</h2>
        <form id="ctrlForm">
            <label>Plattform</label>
            <select name="platform">
                <option value="android">Android (gps_adid)</option>
                <option value="ios">iOS (idfa)</option>
            </select>

            <label>Geräte ID</label>
            <input type="text" name="device_id" placeholder="ID eingeben..." required>

            <label>Event Auswählen</label>
            <select name="event_name">
                {% for event in events %}
                <option value="{{ event }}">{{ event }}</option>
                {% endfor %}
            </select>

            <button type="submit" id="btn">Event Senden</button>
        </form>
        <div id="log">Bereit...</div>
    </div>

    <script>
        const form = document.getElementById('ctrlForm');
        const log = document.getElementById('log');
        const btn = document.getElementById('btn');

        form.onsubmit = async (e) => {
            e.preventDefault();
            btn.disabled = true;
            log.innerHTML = '<span class="loading">Sende an Zone C...</span>';

            const formData = new FormData(form);
            try {
                const response = await fetch('/api/send', { method: 'POST', body: formData });
                const result = await response.json();
                
                log.innerText = result.message;
                log.style.borderLeftColor = result.success ? '#03dac6' : '#cf6679';
            } catch (err) {
                log.innerText = "Fehler: Verbindung unterbrochen.";
                log.style.borderLeftColor = '#cf6679';
            } finally {
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>